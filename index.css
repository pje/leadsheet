@charset "UTF-8";

@import url("./node_modules/tufte-css/tufte.css");
@import url("./node_modules/@fontsource/noto-music/music.css");

:root {
  --light-gray-4: #a89984;

  --neutral-red: #cc241d;
  --neutral-green: #98971a;
  --neutral-yellow: #d79921;
  --neutral-blue: #458588;
  --neutral-purple: #b16286;
  --neutral-aqua: #689d6a;
  --neutral-orange: #d65d0e;

  --faded-red: #9d0006;
  --faded-green: #79740e;
  --faded-yellow: #b57614;
  --faded-blue: #076678;
  --faded-purple: #8f3f71;
  --faded-aqua: #427b58;
  --faded-orange: #af3a03;

  --bright-red: #fb4934;
  --bright-green: #b8bb26;
  --bright-yellow: #fabd2f;
  --bright-blue: #83a598;
  --bright-purple: #d3869b;
  --bright-aqua: #8ec07c;
  --bright-orange: #fe8019;

  --staff-line-height: 14px;
  --staff-height: calc(var(--staff-line-height) * 4);

  @media (max-width: 575px) {
    --num-cols: 2;

    .bar {
      &:nth-child(2n-1) {
        .staff {
          border-inline-start-style: solid;
        }
      }
    }
  }

  --num-cols: 4;
}

html {
  font-size: 100%;
  /* use rem units everywhere now */

  body {
    width: auto;
    padding-inline: 4vw;

    @media (prefers-color-scheme: light) {
      background-color: rgb(255 255 243);
      color: #111;
    }

    @media (prefers-color-scheme: dark) {
      background-color: #151515;
      color: #fffdf3;
    }

    h1, h2, h3, h4, h5 {
      margin: unset;
    }

    .title {
      font-size: min(3.2rem, 8vw);
    }

    .artist {
      font-size: 1.5rem;
    }

    .date:empty, .artist:empty {
      display: none;
    }

    .key-selector {
      align-items: center;
      display: flex;
      min-width: 100px;
      justify-content: flex-end;

      .transpose-buttons {
        display: flex;
        flex-direction: column;
        margin-inline-start: 4px;
      }

      .key {
        text-align: right;
        min-width: 80px;
      }
    }

    button.transpose {
      width: 24px;
      font-size: 12px;
    }

    .unicode-flat, .unicode-sharp {
      position: relative;
      font-size: 15pt;
      left: -5px;
      bottom: 2px;
      margin-right: -8px;
    }
  }
}

#transposed-steps {
  min-width: 25px;
  text-align: center;
}

#toolbar {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
}

#settings {
  cursor: default;
}

#settings[open] {
  display: flex;
  text-align: end;
}

#metadata {
  display: flex;
  gap: 10px;
  flex-direction: column;
  align-items: center;
  margin-block-end: 20px;

  .date, .artist, .album {
    font-weight: 400;
  }

  .album {
    font-style: italic;
  }

  .date:empty, .artist:empty, .album:empty {
    display: none;
  }

  .artist:not(:empty) {
    &:has(+ .album:not(:empty)) {
      &::after {
        content: " ‚Äî";
      }
    }
  }

  .title {
    font-size: min(3.2rem, 8vw);
  }

  .byline {
    display: flex;
    flex-direction: row;
    font-size: 1.4rem;

    & .album:not(:empty) {
      margin-inline-start: 5px;
    }

    & .date:not(:empty) {
      margin-inline-start: 5px;

      &::before {
        content: "(";
      }
      &::after {
        content: ")";
      }
    }
  }
}

#song {
  display: grid;
  grid-template-columns: repeat(var(--num-cols), 1fr);
  align-items: end;
  row-gap: calc(var(--staff-height) * 0.5);

  .bar {
    /* container-type: size; */
    /* container-name: bar; */

    &:nth-child(4n-3) {
      .staff {
        border-inline-start-style: solid;
      }
    }

    /* stylelint-disable-next-line no-descending-specificity */
    .staff {
      --high-g-top: -114cqh;
      --high-f-top: calc(var(--high-g-top) + calc(var(--staff-line-height) / 2));

      container-type: size;
      container-name: staff;
      display: flex;
      justify-content: space-between;
      font-family: "Noto Music";
      height: var(--staff-height);
      border-block-end: none;
      border-top: solid;
      border-top-width: 1px;

      @media (prefers-color-scheme: light) {
        border-color: #111;
        background: repeating-linear-gradient(to top,
            #151515,
            #151515 1px,
            transparent 0,
            transparent 25%);
      }

      @media (prefers-color-scheme: dark) {
        border-color: #fffdf3;
        background: repeating-linear-gradient(to top,
            #fffdf3,
            #fffdf3 1px,
            transparent 0,
            transparent 25%);
      }

      .frontmatter {
        display: flex;
        margin-inline-end: 10cqh;
        font-family: "Noto Music";

        .clef {
          position: relative;
          top: -31cqh;
          font-size: 96cqh;
        }

        .key-signature {
          display: flex;
          letter-spacing: -4cqh;

          .accidental {
            position: relative;
            font-size: 80cqh;

            &.f {
              top: calc(var(--high-f-top) + calc(var(--staff-line-height) * 0));
            }

            &.c {
              top: calc(var(--high-g-top) + calc(var(--staff-line-height) * 2));
            }

            &.g.sharp {
              top: calc(var(--high-g-top) + calc(var(--staff-line-height) * 0));
            }

            &.g.flat {
              top: calc(var(--high-f-top) + calc(var(--staff-line-height) * 3));
            }

            &.d {
              top: calc(var(--high-f-top) + calc(var(--staff-line-height) * 1));
            }

            &.a {
              top: calc(var(--high-g-top) + calc(var(--staff-line-height) * 3));
            }

            &.e {
              top: calc(var(--high-g-top) + calc(var(--staff-line-height) * 1));
            }

            &.b {
              top: calc(var(--high-f-top) + calc(var(--staff-line-height) * 2));
            }
          }
        }

        .time-signature {
          position: relative;
          top: -12cqh;
          margin-inline-start: 18cqh;
          font-size: 71cqh;
          line-height: 51cqh;
          font-weight: bold;
        }
      }

      .content {
        width: 100%;
        display: flex;
      }

      & .barline-single-close {
        border-right-style: solid;
        border-right-width: 1.5px;
      }

      & .barline-double-open {
        font-size: 100cqh;
        &::after {
          position: relative;
          top: -40cqh;
          right: -6cqh;
          content: "ùÑÅ";
        }
      }

      & .barline-double-close {
        font-size: 100cqh;
        &::after {
          position: relative;
          top: -40cqh;
          right: -6cqh;
          content: "ùÑÇ";
        }
      }

      & .barline-repeat-close {
        font-size: 100cqh;
        &::after {
          position: relative;
          top: -40cqh;
          right: -6cqh;
          content: "ùÑá";
        }
      }

      & .barline-repeat-open {
        font-size: 100cqh;
        &::after {
          position: relative;
          top: -40cqh;
          left: -6cqh;
          content: "ùÑÜ";
        }
      }
    }

    &.active {
      .staff {
        animation-name: pulse;
        animation-duration: 1500ms;
        animation-fill-mode: both;
        animation-iteration-count: infinite;
        animation-timing-function: linear;
      }
    }

    .section-name {
      z-index: -1;
      position: relative;
      display: inline-block;
      width: fit-content;
      padding-inline: 0.5rem;
      font-size: 1.5rem;
      font-style: italic;
      border-style: solid;
      border-width: 1px;

      @media (prefers-color-scheme: light) {
        border-color: #111;
      }

      @media (prefers-color-scheme: dark) {
        border-color: #fffdf3;
      }
    }

    .chords {
      container-name: chords;
      container-type: size;
      height: calc(var(--staff-height) * 0.5);
      display: flex;
      flex-direction: row;
      justify-content: space-evenly;
      padding-block-end: 1cqh;

      .chord {
        display: flex;
        flex-direction: row;
        white-space: nowrap;
        /* this prevents long chord names from breaking into multiple lines */
        font-size: 100cqh;
        text-align: center;
        justify-content: center;

        .fractional, .paren-open, .paren-close {
          font-weight: normal;
        }

        .fractional {
          align-items: center;
          display: flex;
          flex-direction: column;
          font-size: 58cqh;
          line-height: 45cqh;
          position: relative;
          top: 15cqh;
        }

        &.aug {
          color: var(--bright-yellow);
        }
        &.dim {
          color: var(--bright-purple);
        }
        &.dom {
          color: var(--neutral-red);
        }
        &.maj {
          color: var(--bright-green);
        }
        &.min {
          color: var(--bright-blue);
        }
        &.no-chord {
          color: inherit;
        }
        &.pow {
          color: var(--light-gray-4);
        }
        &.sus {
          color: var(--bright-orange);
        }
      }
    }
  }
}

#footer {
  display: flex;
  align-items: center;
  justify-content: center;
  padding-top: 5rem;

  #fine {
    font-family: "Noto Music";
    font-size: 3rem;
  }
}

@keyframes pulse {
  0% {
    box-shadow: #007cff80 0 0 0 0;
  }
  75% {
    box-shadow: #ff69b400 0 0 0 16px;
  }
}
